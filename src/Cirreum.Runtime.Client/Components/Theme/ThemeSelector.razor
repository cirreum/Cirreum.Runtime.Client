@namespace Cirreum.Components.Theme
@inject IThemeState ThemeState
@inject IThemeStateManager ThemeManager
@inject IThemeIconNameProvider ThemeIcons

<NavListDropdownButton TItemType="string"
					   IsDropMenu="false"
					   DropdownMinWidth="8"
					   SelectedValue="@ThemeState.Mode"
					   SelectedValueChanged="@OnModeChanged"
					   ResponsiveAlignment="@Alignment"
					   AriaLabel="Theme Selector">
	<TextTemplate>
		@{
			var selectedName = ThemeModeNames.All.FirstOrDefault(s => s == ThemeState.Mode)
			?? ThemeModeNames.Light;
		}
		<i class="bi @ThemeIcons.ResolveModeIcon(selectedName)" aria-hidden="true"></i> @Label
	</TextTemplate>
	<ChildContent>
		@foreach (var modeName in Enum.GetNames<ThemeMode>()) {
			<DropdownItemButton Value="@modeName">
				<InteractiveTemplate>
					<div class="d-flex">
						<i class="bi @ThemeIcons.ResolveModeIcon(modeName)"></i>
						<span class="ms-2">@modeName</span>
						@if (context.IsActive) {
							<i class="bi bi-check ms-auto"></i>
						}
					</div>
				</InteractiveTemplate>
			</DropdownItemButton>
		}
	</ChildContent>
</NavListDropdownButton>

@code {

	/// <summary>
	/// Optional label for the theme selector, displayed next to the icon.
	/// </summary>
	[Parameter]
	public string? Label { get; set; }

	/// <summary>
	/// Defaults to <see cref="DropdownAlignment.End"/> for use with the NavBar
	/// Menu in the top right corner.
	/// </summary>
	[Parameter]
	public DropdownAlignment Alignment { get; set; } = DropdownAlignment.End;

	private void OnModeChanged(string modeName) {
		var mode = Enum.Parse<ThemeMode>(modeName, true);
		this.ThemeManager.SetMode(mode);
	}

}